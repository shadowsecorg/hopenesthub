<div class="p-4">
        <h2>Reports</h2>
        <div class="card p-3 mb-4">
          <form class="row g-2" method="get" action="/admin/reports">
            <div class="col-md-3"><input type="text" name="pid" class="form-control" placeholder="Search by Patient ID" value="<%= pid || '' %>"></div>
            <div class="col-md-3">
              <select class="form-select" name="range" id="rangeSelect">
                <option value="" <%= (range||'') === '' ? 'selected' : '' %>>All Time Periods</option>
                <option value="last-week" <%= (range||'') === 'last-week' ? 'selected' : '' %>>Last Week</option>
                <option value="last-month" <%= (range||'') === 'last-month' ? 'selected' : '' %>>Last Month</option>
                <option value="custom" <%= (range||'') === 'custom' ? 'selected' : '' %>>Custom Range</option>
              </select>
            </div>
            <div class="col-md-3"><input type="date" name="start" class="form-control" id="startDate" value="<%= start || '' %>" <%= (range||'')==='custom' ? '' : 'disabled' %>></div>
            <div class="col-md-3"><input type="date" name="end" class="form-control" id="endDate" value="<%= end || '' %>" <%= (range||'')==='custom' ? '' : 'disabled' %>></div>
            <div class="col-md-3"><button class="btn btn-outline-primary">Generate Report</button></div>
          </form>
        </div>
        <div class="card p-3 mb-4">
          <h5>Summary Statistics</h5>
          <div class="row">
            <div class="col-md-4"><p><strong>Average Heart Rate:</strong> <%= (summary&&summary.avgHeart)||0 %> bpm</p></div>
            <div class="col-md-4"><p><strong>Average Sleep Quality:</strong> <%= (summary&&summary.avgSleep)||0 %>%</p></div>
            <div class="col-md-4"><p><strong>Average Activity:</strong> <%= (summary&&summary.avgSteps)||0 %> steps</p></div>
          </div>
        </div>
        <div class="card p-3 mb-4">
          <h5>Aggregated Charts</h5>
          <div class="row">
            <div class="col-md-4"><h6>Average Heart Rate</h6><div class="chart-container"><canvas id="heartRateChart" data-labels='<%= JSON.stringify((adminReportCharts&&adminReportCharts.labels)||[]) %>' data-series='<%= JSON.stringify((adminReportCharts&&adminReportCharts.heartRate)||[]) %>'></canvas></div></div>
            <div class="col-md-4"><h6>Average Sleep Quality</h6><div class="chart-container"><canvas id="sleepQualityChart" data-labels='<%= JSON.stringify((adminReportCharts&&adminReportCharts.labels)||[]) %>' data-series='<%= JSON.stringify((adminReportCharts&&adminReportCharts.sleepQuality)||[]) %>'></canvas></div></div>
            <div class="col-md-4"><h6>Average Activity</h6><div class="chart-container"><canvas id="activityChart" data-labels='<%= JSON.stringify((adminReportCharts&&adminReportCharts.labels)||[]) %>' data-series='<%= JSON.stringify((adminReportCharts&&adminReportCharts.steps)||[]) %>'></canvas></div></div>
          </div>
        </div>
        <div class="card p-3">
          <h5>Patient Comparison</h5>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr><th>Patient ID</th><th>Name</th><th>Average Heart Rate</th><th>Average Sleep Quality</th><th>Average Activity</th></tr>
              </thead>
              <tbody>
                <% (patientComparison || []).forEach(function(row){ %>
                  <tr>
                    <td><%= row.patient_id %></td>
                    <td><%= row.name %></td>
                    <td><%= typeof row.avg_hr === 'number' ? row.avg_hr : '-' %></td>
                    <td><%= typeof row.avg_sleep === 'number' ? row.avg_sleep : '-' %>%</td>
                    <td><%= typeof row.avg_steps === 'number' ? row.avg_steps : '-' %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <script>
        (function(){
          var sel = document.getElementById('rangeSelect');
          if (!sel) return;
          function toggleDates(){
            var custom = sel.value === 'custom';
            var s = document.getElementById('startDate');
            var e = document.getElementById('endDate');
            if (s) s.disabled = !custom;
            if (e) e.disabled = !custom;
          }
          sel.addEventListener('change', toggleDates);
        })();
      </script>


